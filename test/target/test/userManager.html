<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="layui3.4/css/layui.css"/>
    <script type="text/javascript" src="layui3.4/layui.all.js"></script>
    <script type="text/javascript" src="jquery3.4.1/jquery-3.4.1.js"></script>
    <script type="text/javascript">
        $(function () {
            loadUserData();
        })
        function openUserInfoEdit(id,uname,role,email) {
                // $("#id").html(id),
                // $("#uname").html(uname),
                // $("#role").val(role),
                // $("#email").val(email),
                sessionStorage.setItem("id",id),
                sessionStorage.setItem("uname",uname),
                sessionStorage.setItem("role",role),
                sessionStorage.setItem("email",email),

            layer.open({
                type:1,
                title:"修改用户信息",
                btn:["确认修改","取消"],
                content:$("#editUserInfo").html(),
                area:['400px','350px'],
                yes:function (index) {
                    layer.msg("test")
                }
            })

        }
        function deleteUserInfoById(id){
            layer.confirm("是否真的删除本记录？",{icon:3,title:"警告"},function (index) {
                layer.closeAll()
                    $.ajax({
                        url:"user/deleteUserInfoById.do",
                        method:"post",
                        data:{"id":id},
                        success:function (result) {
                            if(JSON.parse(result)=="success")
                            {
                                layer.msg("删除成功");
                                layui.table.reload("userInfoList")}
                            else {
                                layer.msg("删除失败")
                            }
                        },
                        error:function () {
                            layui.msg("请求服务器失败")
                        }
                    })

            });
        }
        function loadUserData() {
            var table=layui.table;
            table.render({
                toolbar:"#toolbar",
                elem:"#userInfoList",
                url:"user/findAllUser.do",
                title:"用户信息表",
                limit:5,
                page:true,
                limits:[5,10,20,50,100],
                loading:true,
                cols: [
                       [
                           {
                               field:"id",
                               title:"ID",
                               type:"checkbox"
                           },
                          {
                              field:"",
                              title:"ID",
                              type:"numbers"
                          },
                        {
                        field:"uname",
                        title:"用户名",
                        align:"center"
                        },
                        {
                            field:"email",
                            title:"邮箱",
                            align:"center"
                        },
                        {
                        field:"role",
                        title:"角色",
                        align:"center"
                        },
                        {
                            field:"regeisterTime",
                            title:"注册时间",
                            align:"center"
                        },
                        {
                            field:"lastLoginTime",
                            title:"最后登陆时间",
                            align:"center"
                        },
                           {
                               field:"id",
                               title:"操作",
                               align:"center",
                               templet:function (row) {
                                   var edit= '<a href="javascript:openUserInfoEdit(' + row.id+",'"+row.uname+"','"+row.role+"','"+row.email + '\');" style="font-size: 25px;color: blue" title="编辑">' +
                                       "<span class='layui-icon layui-icon-util'></span></a>";
                                    var del='<a href="javascript:deleteUserInfoById('+row.id+');" style="font-size: 25px;color: red" title="删除">' +
                                        "<span class='layui-icon layui-icon-delete'></span></a>";
                                   return edit+"&nbsp;"+del;
                               }
                           }

                       ]
                 ]
            })
        }



    </script>
</head>
<body>
    <div class="layui-elem-quote">
        用户管理功能
    </div>
    <script type="text/html" id="toolbar">
    <a href="" class="layui-btn layui-btn-danger">添加用户</a>
        <a href="" class="layui-btn layui-btn-warm">删除用户</a>
        <input class="layui-input-block" type="text" placeholder="请输入要查询的信息">
    <a href="" class="layui-btn layui-btn-warm"><span class="layui-icon layui-icon-search"></span></a>
</script>
    <table class="layui-table" id="userInfoList">

    </table>
    <div align="center" id="editUserInfo" style="display: none" style="width: 300px">
        <br>
        <center>
            <h2 >修改用户信息</h2>
        </center>
        <hr>
        <form class="layui-form" id="form1">
            <input type="hidden" id="id">
            <div class="layui-form-item">
                <label class="layui-form-label">用户名</label>
                <div class="layui-input-inline">
                    <input type="text" id="uname" name="uname" lay-verify="uname" autocomplete="off"
                           placeholder="请输入用户名" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">邮箱</label>
                <div class="layui-input-inline">
                    <input type="text" id="email" name="email" lay-verify="email" autocomplete="off"
                           placeholder="请输入邮箱" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">角色</label>
                <div class="layui-input-inline">
                    <input type="text" id="role" name="role" lay-verify="role" autocomplete="off"
                           placeholder="请输入身份" class="layui-input">
                </div>
            </div>
        </form>
    </div>
</body>
</html>